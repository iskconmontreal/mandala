---
---
<div class="page-header" style="display:flex; align-items:baseline; justify-content:space-between">
  <div>
    <h1>Summary</h1>
  </div>
  <div style="display:flex; align-items:center; gap:var(--s-md)">
    <div style="position:relative">
      <button class="btn btn-primary btn-sm" :onclick="showAdd = !showAdd">+</button>
      <div class="quick-add" :if="showAdd">
        <a href="donations.html" class="quick-add-item">+ Donation</a>
        <a href="expenses.html" class="quick-add-item">+ Expense</a>
      </div>
    </div>
    <select class="year-select" :onchange="year = +e.target.value">
      <option value="2026" selected>2026</option>
      <option value="2025">2025</option>
      <option value="2024">2024</option>
    </select>
  </div>
</div>

<!-- Net total -->
<div class="summary-card">
  <div class="summary-main">
    <div class="stat-label">Net Total</div>
    <div class="stat-value" :text="'$' + Math.abs(stats.net).toLocaleString(undefined, {minimumFractionDigits: 2})"></div>
    <div class="stat-sub" :text="stats.netChange"></div>
  </div>
</div>

<!-- Stat cards -->
<div class="card-grid">
  <div class="card">
    <div class="stat-label stat-ok">Donations</div>
    <div class="stat-value" :text="'$' + stats.donations.toLocaleString(undefined, {minimumFractionDigits: 2})"></div>
    <div class="stat-sub stat-ok" :text="stats.donationChange"></div>
  </div>
  <div class="card">
    <div class="stat-label stat-err">Expenses</div>
    <div class="stat-value" :text="'$' + stats.expenses.toLocaleString(undefined, {minimumFractionDigits: 2})"></div>
    <div class="stat-sub stat-err" :text="stats.expenseChange"></div>
  </div>
  <div class="card">
    <div class="stat-label">Members</div>
    <div class="stat-value" :text="stats.members"></div>
    <div class="stat-sub" :text="stats.memberSub"></div>
  </div>
  <div class="card">
    <div class="stat-label">Donors</div>
    <div class="stat-value" :text="stats.donors"></div>
    <div class="stat-sub" :text="stats.donorSub"></div>
  </div>
</div>

<!-- Transactions -->
<div class="card">
  <div class="card-header">
    <h3>Transactions</h3>
    <div class="stat-sub" :text="stats.txSummary"></div>
  </div>
  <div class="table-wrap">
    <table>
      <thead>
        <tr>
          <th>Date</th>
          <th>Description</th>
          <th>Category</th>
          <th style="text-align:right">Amount</th>
        </tr>
      </thead>
      <tbody>
        <tr :each="item in recent">
          <td :text="item.date"></td>
          <td :text="item.desc"></td>
          <td><span class="badge" :text="item.cat"></span></td>
          <td style="text-align:right" :class="item.type === 'in' ? 'stat-ok' : 'stat-err'"
            :text="(item.type === 'in' ? '+' : '−') + '$' + item.amt.toLocaleString(undefined, {minimumFractionDigits: 2})"></td>
        </tr>
      </tbody>
    </table>
  </div>
</div>

<script type="module">
  import sprae from '../lib/sprae.js'
  import { auth } from '../lib/auth.js'
  import { api } from '../lib/api.js'

  auth.capture()

  const page = location.pathname.split('/').pop() || 'index.html'

  // Temp sample data — replace with api.get('/home') when ready
  const tmpRecent = [
    { date: '2026-02-25', desc: 'Sunday Feast donation',       cat: 'Donation',    type: 'in',  amt: 1250.00 },
    { date: '2026-02-25', desc: 'Electricity bill',            cat: 'Utilities',   type: 'out', amt: 342.18 },
    { date: '2026-02-24', desc: 'Monthly pledge — Govinda Das', cat: 'Donation',    type: 'in',  amt: 500.00 },
    { date: '2026-02-24', desc: 'Groceries for prasadam',      cat: 'Kitchen',     type: 'out', amt: 287.45 },
    { date: '2026-02-23', desc: 'Book distribution proceeds',  cat: 'Donation',    type: 'in',  amt: 830.00 },
    { date: '2026-02-23', desc: 'Flower garlands',             cat: 'Deity',       type: 'out', amt: 125.00 },
    { date: '2026-02-22', desc: 'Gaura Purnima sponsorship',   cat: 'Donation',    type: 'in',  amt: 2000.00 },
    { date: '2026-02-22', desc: 'Printer ink & paper',         cat: 'Office',      type: 'out', amt: 89.99 },
    { date: '2026-02-21', desc: 'Annadana donation',           cat: 'Donation',    type: 'in',  amt: 375.00 },
    { date: '2026-02-21', desc: 'Plumber repair',              cat: 'Maintenance', type: 'out', amt: 210.00 },
  ]

  const don = 12480.00, exp = 8635.47, total = don + exp

  const s = sprae(document.getElementById('app'), {
    user: auth.user,
    active: (href) => href === page,
    logout: () => auth.logout(),
    userMenu: false,

    year: 2026,
    showAdd: false,
    stats: {
      donations: don,
      expenses: exp,
      net: don - exp,
      donPct: Math.round(don / total * 100),
      expPct: Math.round(exp / total * 100),
      netChange: '+1.3% from last year',
      donationChange: '↑ 18% vs last year',
      expenseChange: '↑ 4% vs last year',
      members: 47,
      memberSub: '3 new this month',
      donors: 23,
      donorSub: '5 recurring',
      txSummary: 'You had 5 donations and 5 expenses this month',
    },
    recent: tmpRecent,
  })

  // When API is ready:
  // api.get('/home').then(data => {
  //   if (data.stats) Object.assign(s.stats, data.stats)
  //   if (data.recent) s.recent = data.recent
  // }).catch(() => {})
</script>
